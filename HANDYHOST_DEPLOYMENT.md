# Развертывание на HandyHost

## ✅ Хорошие новости:

1. **HandyHost поддерживает создание поддоменов!**
2. Есть два способа создания поддоменов
3. Можно использовать автоматические поддомены

---

## Вариант 1: Создание поддомена `voice.icesmoke.store` (РЕКОМЕНДУЕТСЯ)

### Способ A: Вручную через панель

1. **Войдите в панель управления HandyHost**
2. **Перейдите в раздел "WWW-домены"**
3. **Нажмите кнопку "Создать"**
4. **В поле "Имя" введите:** `voice.icesmoke.store`
5. **Укажите корневую директорию** (например, `~/www/voice/`)
6. **Нажмите "ОК"**

⚠️ **Ограничение:** Количество поддоменов зависит от тарифного плана (например, vHOST-1 = 2 сайта включая поддомены)

### Способ B: Автоматические поддомены (БЕЗ ЛИМИТА!)

Это **лучший вариант**, так как не учитывается в лимите сайтов!

1. **В панели управления → "WWW-домены"**
2. **Выберите домен `icesmoke.store` и нажмите "Изменить"**
3. **В настройках найдите "Автоматические поддомены"**
4. **Выберите один из вариантов:**

   **Вариант 1: "В отдельной директории"**
   - Создайте папку: `~/www/voice.icesmoke.store/`
   - Она автоматически станет поддоменом `voice.icesmoke.store`

   **Вариант 2: "В поддиректории домена"**
   - Создайте папку: `~/www/icesmoke.store/voice/`
   - Она автоматически станет поддоменом `voice.icesmoke.store`

5. **Сохраните изменения**

---

## Вариант 2: Использование пути `/voice/` на основном домене

Если поддомен не подходит, можно использовать путь на основном домене.

### Настройка через `.htaccess` (если Apache):

Создайте файл `~/www/icesmoke.store/.htaccess`:

```apache
RewriteEngine On
RewriteBase /voice/

# Проксирование на Flask (если запущен на порту 5000)
RewriteCond %{REQUEST_URI} ^/voice/
RewriteRule ^voice/(.*)$ http://127.0.0.1:5000/$1 [P,L]
```

⚠️ **Проблема:** Для Flask нужен прокси, а на shared hosting это может не работать.

---

## ⚠️ ВАЖНО: Поддержка Python на HandyHost

### Нужно проверить:

1. **Есть ли Python в системе?**
   ```bash
   python3 --version
   python --version
   ```

2. **Можно ли устанавливать пакеты?**
   ```bash
   pip3 --version
   ```

3. **Есть ли возможность запускать долгоживущие процессы?**
   - На shared hosting обычно **НЕТ**
   - Нужен VPS или выделенный сервер

### Если Python не поддерживается:

**Альтернативы:**
1. **Использовать внешний сервер** для Flask (например, отдельный VPS)
2. **Использовать сервисы типа Heroku, Railway, Render**
3. **Спросить в поддержке HandyHost** про поддержку Python

---

## План действий:

### Шаг 1: Проверка поддержки Python

В веб-консоли выполните:

```bash
# Проверка Python
python3 --version
python --version

# Проверка pip
pip3 --version

# Проверка возможности запуска процессов
ps aux | grep python
```

### Шаг 2: Создание поддомена

**Рекомендую использовать автоматические поддомены:**

1. В панели: **WWW-домены → icesmoke.store → Изменить**
2. Включите **"Автоматические поддомены" → "В отдельной директории"**
3. Создайте папку: `~/www/voice.icesmoke.store/`
4. Поддомен создастся автоматически!

### Шаг 3: Загрузка кода

Загрузите код приложения в папку поддомена:
- `~/www/voice.icesmoke.store/` (для автоматических поддоменов)
- или указанную при создании поддомена вручную

### Шаг 4: Настройка приложения

1. Создайте виртуальное окружение:
   ```bash
   cd ~/www/voice.icesmoke.store/
   python3 -m venv venv
   source venv/bin/activate
   pip install -r requirements.txt
   pip install gunicorn
   ```

2. Настройте `.env`:
   ```env
   APP_PREFIX=/
   YANDEX_TTS_ENABLED=true
   YANDEX_TTS_OAUTH_TOKEN=ваш_токен
   YANDEX_TTS_FOLDER_ID=ваш_folder_id
   ```

3. Инициализируйте БД:
   ```bash
   python init_db.py
   ```

### Шаг 5: Запуск приложения

**Проблема:** На shared hosting обычно нельзя запускать долгоживущие процессы.

**Решения:**

1. **Если есть доступ к cron или задачам:**
   - Настройте автозапуск через cron (но это не идеально)

2. **Если есть доступ к systemd:**
   - Создайте systemd сервис (см. `deploy_production.sh`)

3. **Если ничего не работает:**
   - Используйте внешний сервер для Flask
   - Или спросите в поддержке HandyHost

---

## Проверка возможностей HandyHost:

### В веб-консоли выполните:

```bash
# 1. Проверка Python
echo "=== Python ===" && \
python3 --version 2>/dev/null && echo "✅ Python3 установлен" || echo "❌ Python3 не найден" && \
python --version 2>/dev/null && echo "✅ Python установлен" || echo "❌ Python не найден"

# 2. Проверка pip
echo "" && echo "=== pip ===" && \
pip3 --version 2>/dev/null && echo "✅ pip3 доступен" || echo "❌ pip3 не найден"

# 3. Проверка структуры
echo "" && echo "=== Структура www ===" && \
ls -la ~/www/

# 4. Проверка процессов
echo "" && echo "=== Процессы Python ===" && \
ps aux | grep python | grep -v grep
```

---

## Если Python не поддерживается:

### Вариант A: Внешний сервер

1. Разверните Flask на отдельном VPS (например, на другом хостинге)
2. На HandyHost настройте проксирование поддомена на внешний сервер

### Вариант B: Облачные сервисы

Используйте бесплатные сервисы:
- **Railway.app** (бесплатный тариф)
- **Render.com** (бесплатный тариф)
- **Fly.io** (бесплатный тариф)

И настройте поддомен `voice.icesmoke.store` на проксирование к облачному сервису.

---

## Следующие шаги:

1. ✅ Проверьте поддержку Python (команды выше)
2. ✅ Создайте поддомен через панель (автоматические поддомены)
3. ✅ Загрузите код
4. ⚠️ Проверьте возможность запуска долгоживущих процессов
5. ⚠️ Если не работает - рассмотрите внешний сервер

---

## Полезные ссылки:

- [Официальная документация HandyHost по поддоменам](https://handyhost.ru/help/hosting/poddomenyi.html)
- [Видеоинструкция по созданию поддомена](https://www.youtube.com/watch?v=VVbVkuAoyb4)

